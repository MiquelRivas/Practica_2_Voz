---
title: "Síntomas vocales en profesores"
subtitle: "20582- Análisis de Datos para el GMAT"
date: today
format:
  html:
    theme: lumen
    toc: true
    toc-depth: 3
Rendering:
    embed-resources: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(readr)
#library(hrbrthemes)
library(janitor)
library(viridis)
```

## Lectura y limpieza de los datos

Leemos los datos del fichero "Salut_Vocal_anonimizada.csv" y cambiamos los nombres de las variables.

```{r}
raw_data<-read.csv("Salut_Vocal_anonimizada.csv",
                   header=TRUE, sep=";")

raw_data <- raw_data %>% select(-X) %>% 
   rename(
    Importancia_voz = "De.l.1.al.10.quina.importancia.té.la.veu.per.a.vostè.",
    Sexo = "Sexe",
    Lugar_trabajo="On.fa.feina.",
    Cuerpo_docente="Cos.docent",
    Edad="Quina.edat.té.",
    Actividas_fisica="Practica.esport.o.fa.alguna.activitat.física.",
    Importancia_deporte="De.l.1.al.10.quina.importancia.té.la.pràctica.de.l.esport.o.activitat.física.per.a.vostè.",
    Calidad_sueño="Té.una.bona.qualitat.del.son.",
    Cafe="Consumeix.cafè.",
    Tabaco="Consumeix.tabac.",
    Alcohol="Consumeix.alcohol.",
    Bebida_gas="Consumeix.begudes.amb.gas.",
    Dieta_saludable="De..l.1.al.10.assenyali.si.segueix.una.dieta.equilibrada.i.saludable.",
    Diagnostico="Ha.estat.diagnosticat.per.un.metge.o.metgessa.d.alguna.de.les.malalties.següents.",
    Patologia="Si.ha.marcat.alguna.de.les.opcions.anterior..especifiqui.la.patologia.",
    Diagnostico_especialista="Ha.estat.diagnosticat.per.un.especialista.mèdic..otorinolaringòleg..foniatra..d.alguna.lesió.a.les.cordes.vocals.",
    Sintomas="Aquest.mes.ha.tengut.algún.símptoma.vocal.dels.següents..Es.pot.marcar.més.d.una.opció",
    Operacion="L.han.operat.de.les.cordes.vocals.",
    Tiempo_alteracion="Si.té.alguna.alteració.de.la.veu..recorda.quin.temps.fa.que.va.començar.",
    Baja_voz="En.alguna.ocasió..ha.estat.de.baixa.laboral.per.problemes.de.veu.",
    Baja_larga="Si.la.resposta.a.la.pregunta.anterior.és.afirmativa..indiqui.la.periodicitat..cada.any..trimestre.....i.la.durada.de.la.baixa.més.llarga.i.la.malaltia",
    Problema_curso22_23="Ha.tengut.problemes.de.veu.importants.i.que.li.han.dificultat.la.feina.al.llarg.del.curs.2022.2023.",
    Formacion_voz="Té.formació.sobre.salut.vocal.",
    Medicacion="Pren.alguna.o.algunes.de.les.medicacions.següents..Es.pot.marcar.més.d.una.opció",
    Higiene_vocal="Segueix.una.rutina.d.higiene.vocal.",
    Actividades="Fa.alguna.de.les.activitats.següents..Es.pot.marcar.més.d.una.opció",
    No_me_ecuchan="La.gent.em.sent.amb.dificultat.a.causa.de.la.meva.veu",
    No_me_escuchan_ruido="La.gent.no.m.entén.en.llocs.sorollosos",
    Alteracion_vida_social="Els.meus.problemes.amb.la.veu.alteren.la.meva.vida.personal.i.social",
    Desplazado_conversacion="Em.sent.desplaçat.de.les.converses.per.la.meva.veu",
    Rendimiento_laboral="El.meu.problema.amb.la.veu.afecta.el.rendiment.laboral",
    Tensar_producir_voz="Not.que.necessit.tensar.la.gola..gargamella..per.produir.la.veu",
    Calidad_imprevisible="La.qualitat.de.la.meva.veu.és.imprevisible",
    Me_molesta="La.meva.veu.em.molesta",
    Minusvalia="La.meva.veu.em.fa.sentir.certa.minusvalidesa",
    Gente_pregunta="La.gent.em.pregunta..què.et.passa.amb.la.veu."
)

glimpse(raw_data)
```

Observamos que hay 185 respuestas y 37 variables. Vamos a limpiar los nombres de las variables y a convertir las variables categóricas en factores, a excepción de las variables "importancia_voz", "importancia_deporte" y "dieta_saludable" que las dejamos como variables cuantitativas discretas.

```{r}
data <- janitor::clean_names(raw_data) %>% 
        mutate(across(-c(importancia_voz,
                         importancia_deporte,
                         dieta_saludable), as.factor))

glimpse(data)

```

Ahora, para calcular el índice de calidad de voz (VHI), vamos a seleccionar las variables desde la 28 a la 37 para convertirlas en cuantitativas discretas y a sumarlas para obtener el índice VIH.

```{r}
datos<-data %>% select(28:37) %>% 
  mutate(across(everything(), ~case_when(
     . == "Mai" ~ 0,
     . == "Gairebé mai" ~ 1,
     . == "A vegades" ~ 2,
     . == "Gairebé sempre" ~ 3,
     . == "Sempre" ~ 4
   ))
   )

datos<-datos %>% mutate(VHI=rowSums(datos))

glimpse(datos) 
```

Por último, vamos a añadir la variable VHI al dataframe original y a eliminar las variables de la 28 a la 37.

```{r}
data<-data %>% select(-c(28:37))%>% 
   bind_cols(VHI=datos$score)
glimpse(data) 
```

## P7: ¿El cuidado de voz mejora la calidad de la misma? ¿Cuál es la mejor medida?

**Grupo escuderia_ferrrari: Álvaro Velasco Sobrino, Carlos Bayes Liébana, Miquel Rivas Vanrell**

No encuentro en mi correo vuestra entrega. En todo caso hay que cruzar el score VIH con la pregunta si el participante sigue una rutina de higiene vocal.

Hacer un boxplot entre la higiene vocal y el score. Y luego una prueba inferencial.

```{r}
table(data$higiene_vocal)

data <- data %>% 
  dplyr::mutate(higiene_vocal = case_when(
    higiene_vocal == "Bec molta d'aigua" ~ "Mucha agua.",
    higiene_vocal == "Bec molta d'aigua, No seguesc cap rutina per a la veu" ~ "Mucha agua, no rutina.",
    higiene_vocal == "Escalf la veu abans de començar la feina, Faig repòs vocal després de la feina" ~ "Calienta y reposo.",
    higiene_vocal == "Escalf la veu abans de començar la feina, Faig repòs vocal després de la feina, Bec molta d'aigua" ~ "Calienta, reposo y mucha agua.",
    higiene_vocal == "Escalf la veu abans de començar la feina" ~ "Caliento.",
    higiene_vocal == "Faig repòs vocal després de la feina" ~ "Reposo.",
    higiene_vocal == "Faig repòs vocal després de la feina, Bec molta d'aigua" ~ "Reposo y mucha agua.",
    higiene_vocal == "Faig repòs vocal després de la feina, Bec molta d'aigua, No seguesc cap rutina per a la veu" ~ "Reposo y mucha agua.",
    higiene_vocal == "No seguesc cap rutina per a la veu" ~ "No rutina.",
    TRUE ~ higiene_vocal  # Para mantener las categorías que no coincidan
  ))


table(data$higiene_vocal)

data$VHI = datos$VHI

resumen <- data %>% 
  group_by(higiene_vocal) %>% 
  summarise(
    media_VHI = mean(VHI),
    mediana_VHI = median(VHI),
    desviacion_VHI = sd(VHI),
    n = n()
  )

ggplot(data = data, aes(x = higiene_vocal, y = VHI, fill = higiene_vocal)) +
  geom_boxplot() +
  labs(title = "Distribución del Score VHI por Rutina de Higiene Vocal",
       x = "Higiene Vocal", y = "Score VHI") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 7.5),legend.position = "none") 
```

Para facilitarnos el trabajo a la hora de hacer el test de inferencia, que en este caso será de correlación, consideramos que este es el test de inferencia más adecuado ya que nos dirá a que nivel encontramos relación entre estas variables (que es lo que se quiere responder en estas preguntas). Para ello, convertiremos las respuestas (cualitativas) en valores numéricos:
  
  Lo que haremos será asignar una variable numérica a cada respuesta posible ordenada de menor a mayor según lo buena o efectiva que es la rutina que siguen (orden de prioridad). Así, para no evitar contradicciones con las respuestas lo que haremos será considerar solo 6 de estas respuestas, que son: "Mucha agua", "Calienta y reposo", "Calienta, reposo y mucha agua", "Reposo", "No rutina", "Reposo y mucha agua".

Para realizarlo, nos compararemos estas respuestas con las de otra pregunta. La pregunta será: "Ha tengut problemes de veu importants i que li han dificultat la feina al llarg del curs 2022-2023?". 

Lo haremos por frecuencias, es decir, calcularemos con que frecuencias alguien que no hace rutina ha tenido problemas y mediante estas frecuencias determinaremos el orden de prioridad. 

```{r}
data_seleccionado <- data %>% select(problema_curso22_23,higiene_vocal)


frecuencias <- data_seleccionado %>%
  count(problema_curso22_23, higiene_vocal) # Contar las combinaciones
  
  
  # Mostrar la tabla de frecuencias relativas
print(frecuencias)
```


Ahora, debemos calcular la probabilidad de no tener enfermedad con cada una de las respuestas. 



```{r}
probabilidades <- frecuencias %>%
  group_by(higiene_vocal) %>%                       
  mutate(Probabilidad = n / sum(n)) %>% 
  ungroup()

# Mostrar la tabla con las probabilidades
print(probabilidades)
```

Por tanto, lo mejor es lo que en problema_curso22_23 tenga mayor probabilidad.
1-No rutina
2-Hace reposo
3-Hace reposo y bebe mucha agua
4-Bebe mucha agua
5-Calienta, hace reposo y bebe mucha agua
6-Escalf la veu abans de començar la feina

Notemos que este podium no tiene sentido lógico ya que por intuición se espera que tener una rutina sea lo mejor para la voz pero no es así. Esto se puede deber a la falta de respuestas (ya que solo hay dos observaciones de los tratamientos aparentemente mejores). 
Es por ello, que haremos dos pruebas de inferencia, una con los resultados obtenidos en la clasificación y el otro con nuestra clasificación.

**ORDENACIÓN OBTENIDOS**
```{r}
datos <- data %>%
  mutate(higiene_vocal_num = case_when(
    higiene_vocal == "Mucha agua." ~ 2,
    higiene_vocal == "Calienta y reposo." ~ 0,
    higiene_vocal == "Calienta, reposo y mucha agua." ~ 1,
    higiene_vocal == "Reposo." ~ 4,
    higiene_vocal == "No rutina." ~ 5,
    higiene_vocal == "Reposo y mucha agua." ~ 3
  ))
```

Ahora realizamos el test:
  
```{r}
resultado_cor <- datos %>%
  summarise(cor_test = list(cor.test(VHI, higiene_vocal_num, method = "pearson", use = "complete.obs"))) %>%
  pull(cor_test)
print(resultado_cor)
```
Esto significa que esta ordenación no tiene sentido.

**ORDENACIÓN PROPIA**

```{r}
datos <- data %>%
  mutate(higiene_vocal_num = case_when(
    higiene_vocal == "Bebe mucha agua" ~ 1,
    higiene_vocal == "Calienta y hace reposo" ~ 3,
    higiene_vocal == "Calienta, hace reposo y bebe mucha agua" ~ 5,
    higiene_vocal == "Hace reposo" ~ 2,
    higiene_vocal == "No rutina" ~ 0,
    higiene_vocal == "Hace reposo y bebe mucha agua" ~ 4
  ))
```

Ahora realizamos el test:

```{r}
resultado_cor <- datos %>%
  summarise(cor_test = list(cor.test(VHI, higiene_vocal_num, method = "pearson", use = "complete.obs"))) %>%
  pull(cor_test)
print(resultado_cor)
```

Como podemos ver, al ser el resultado del test una correlación del 0.31295. Pese a ser relativamente moderada, se puede afirmar que las rutinas de higiene vocal tienen correlación con el VHI.

**Respuesta a la pregunta 7:**

Dado que la correlación es notable entre el cuidado de la voz y el mejoramiento de la misma, respondemos de forma afirmativa a esta pregunta. Para la segunda parte de la pregunta, tenemos que el método más efectivo es la unión de "Calienta, hace reposo y bebe mucha agua".