---
title: "Síntomas vocales en profesores"
subtitle: "20582- Análisis de Datos para el GMAT"
date: today
format:
  html:
    theme: lumen
    toc: true
    toc-depth: 3
Rendering:
    embed-resources: true
---

**Grupo escuderia_ferrrari: Álvaro Velasco Sobrino, Carlos Bayes Liébana, Miquel Rivas Vanrell**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(readr)
#library(hrbrthemes)
library(janitor)
library(viridis)
library(gt)
```


```{r, echo = FALSE}
raw_data<-read.csv("Salut_Vocal_anonimizada.csv",
                   header=TRUE, sep=";")

raw_data <- raw_data %>% select(-X) %>% 
   rename(
    Importancia_voz = "De.l.1.al.10.quina.importancia.té.la.veu.per.a.vostè.",
    Sexo = "Sexe",
    Lugar_trabajo="On.fa.feina.",
    Cuerpo_docente="Cos.docent",
    Edad="Quina.edat.té.",
    Actividas_fisica="Practica.esport.o.fa.alguna.activitat.física.",
    Importancia_deporte="De.l.1.al.10.quina.importancia.té.la.pràctica.de.l.esport.o.activitat.física.per.a.vostè.",
    Calidad_sueño="Té.una.bona.qualitat.del.son.",
    Cafe="Consumeix.cafè.",
    Tabaco="Consumeix.tabac.",
    Alcohol="Consumeix.alcohol.",
    Bebida_gas="Consumeix.begudes.amb.gas.",
    Dieta_saludable="De..l.1.al.10.assenyali.si.segueix.una.dieta.equilibrada.i.saludable.",
    Diagnostico="Ha.estat.diagnosticat.per.un.metge.o.metgessa.d.alguna.de.les.malalties.següents.",
    Patologia="Si.ha.marcat.alguna.de.les.opcions.anterior..especifiqui.la.patologia.",
    Diagnostico_especialista="Ha.estat.diagnosticat.per.un.especialista.mèdic..otorinolaringòleg..foniatra..d.alguna.lesió.a.les.cordes.vocals.",
    Sintomas="Aquest.mes.ha.tengut.algún.símptoma.vocal.dels.següents..Es.pot.marcar.més.d.una.opció",
    Operacion="L.han.operat.de.les.cordes.vocals.",
    Tiempo_alteracion="Si.té.alguna.alteració.de.la.veu..recorda.quin.temps.fa.que.va.començar.",
    Baja_voz="En.alguna.ocasió..ha.estat.de.baixa.laboral.per.problemes.de.veu.",
    Baja_larga="Si.la.resposta.a.la.pregunta.anterior.és.afirmativa..indiqui.la.periodicitat..cada.any..trimestre.....i.la.durada.de.la.baixa.més.llarga.i.la.malaltia",
    Problema_curso22_23="Ha.tengut.problemes.de.veu.importants.i.que.li.han.dificultat.la.feina.al.llarg.del.curs.2022.2023.",
    Formacion_voz="Té.formació.sobre.salut.vocal.",
    Medicacion="Pren.alguna.o.algunes.de.les.medicacions.següents..Es.pot.marcar.més.d.una.opció",
    Higiene_vocal="Segueix.una.rutina.d.higiene.vocal.",
    Actividades="Fa.alguna.de.les.activitats.següents..Es.pot.marcar.més.d.una.opció",
    No_me_ecuchan="La.gent.em.sent.amb.dificultat.a.causa.de.la.meva.veu",
    No_me_escuchan_ruido="La.gent.no.m.entén.en.llocs.sorollosos",
    Alteracion_vida_social="Els.meus.problemes.amb.la.veu.alteren.la.meva.vida.personal.i.social",
    Desplazado_conversacion="Em.sent.desplaçat.de.les.converses.per.la.meva.veu",
    Rendimiento_laboral="El.meu.problema.amb.la.veu.afecta.el.rendiment.laboral",
    Tensar_producir_voz="Not.que.necessit.tensar.la.gola..gargamella..per.produir.la.veu",
    Calidad_imprevisible="La.qualitat.de.la.meva.veu.és.imprevisible",
    Me_molesta="La.meva.veu.em.molesta",
    Minusvalia="La.meva.veu.em.fa.sentir.certa.minusvalidesa",
    Gente_pregunta="La.gent.em.pregunta..què.et.passa.amb.la.veu."
)

#glimpse(raw_data)
```



```{r, echo = FALSE}
data <- janitor::clean_names(raw_data) %>% 
        mutate(across(-c(importancia_voz,
                         importancia_deporte,
                         dieta_saludable), as.factor))

#glimpse(data)

```



```{r, echo = FALSE}
datos<-data %>% select(28:37) %>% 
  mutate(across(everything(), ~case_when(
     . == "Mai" ~ 0,
     . == "Gairebé mai" ~ 1,
     . == "A vegades" ~ 2,
     . == "Gairebé sempre" ~ 3,
     . == "Sempre" ~ 4
   ))
   )

datos<-datos %>% mutate(VHI=rowSums(datos))

#glimpse(datos) 
```



```{r, echo = FALSE}
data<-data %>% select(-c(28:37))%>% 
   bind_cols(VHI=datos$VHI)
#glimpse(data) 
```

## P7: ¿El cuidado de voz mejora la calidad de la misma? ¿Cuál es la mejor medida?

**Grupo escuderia_ferrrari: Álvaro Velasco Sobrino, Carlos Bayes Liébana, Miquel Rivas Vanrell** 

Analizamos la pregunta: "Segueix una rutina d'higiene vocal?" la cual tiene cuatro posibles respuestas de multiselección. Debemos hacer un apunte ya que esto puede suponer un inconveniente dando lugar a contradicciones. Por ejemplo, puede haber alguien que considere que calentar la voz antes de trabajar no es una rutina y que por tanto seleccione las opciones de "Escalf la veu abans de començar la feina" y "No seguesc cap rutina per a la veu". Es por ello y para evitar contradicciones que hemos encontrado, reordenamos las respuestas en los grupos que se muestran en el gráfico posterior.

```{r, echo = FALSE}
data <- data %>% 
  dplyr::mutate(higiene_vocal = case_when(
    higiene_vocal == "Bec molta d'aigua" ~ "Mucha agua",
    higiene_vocal == "Bec molta d'aigua, No seguesc cap rutina per a la veu" ~ "Mucha agua",
    higiene_vocal == "Escalf la veu abans de començar la feina, Faig repòs vocal després de la feina" ~ "Calienta y reposo",
    higiene_vocal == "Escalf la veu abans de començar la feina, Faig repòs vocal després de la feina, Bec molta d'aigua" ~ "Calienta, reposo y mucha agua",
    higiene_vocal == "Escalf la veu abans de començar la feina" ~ "Caliento",
    higiene_vocal == "Faig repòs vocal després de la feina" ~ "Reposo",
    higiene_vocal == "Faig repòs vocal després de la feina, Bec molta d'aigua" ~ "Reposo y mucha agua",
    higiene_vocal == "Faig repòs vocal després de la feina, Bec molta d'aigua, No seguesc cap rutina per a la veu" ~ "Reposo y mucha agua",
    higiene_vocal == "No seguesc cap rutina per a la veu" ~ "No rutina",
    TRUE ~ higiene_vocal  # Para mantener las categorías que no coincidan
  ))

resumen <- data %>% 
  group_by(higiene_vocal) %>% 
  summarise(
    media_VHI = mean(VHI),
    mediana_VHI = median(VHI),
    desviacion_VHI = sd(VHI),
    q1 = quantile(VHI, 0.25),
    q3 = quantile(VHI, 0.75),
    IQR = q3-q1,
    observaciones = n()
  )
print(resumen)

# Crear el boxplot con los conteos
ggplot(data = data, aes(x = higiene_vocal, y = VHI, fill = higiene_vocal)) +
  geom_boxplot() +
  labs(title = "Distribución del Score VHI por Rutina de Higiene Vocal",
       x = "Higiene Vocal", y = "Score VHI") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 7.5),
        legend.position = "none") +
  geom_text(data = resumen, aes(x=higiene_vocal, y=Inf, label = paste("n= ", observaciones)),position=position_dodge(0.9) , vjust = 1.5, size = 3)
```

Como podemos observar algo no va bien, ya que según las directrices de los doctores, cuanto más baja sea la puntuación, significa mejor rutina. Por este motivo, la mejor rutina sería no seguir ninguna rutina, lo cual es sorprendente. 
Ahora, hay que remarcar que tenemos pocos datos como para que sea concluyente, ya que solo hay dos personas que calientan y hacen reposo, dos que calientas, hacen reposo y beben mucha agua etc. Así, podemos intentar agrupar estas categorías con menos integrantes en otras. De este modo se obtiene:
```{r}
data <- data %>% 
  dplyr::mutate(higiene_vocal = case_when(
    higiene_vocal == "Calienta y reposo" ~ "Reposo",
    higiene_vocal == "Calienta, reposo y mucha agua" ~ "Reposo",
    TRUE ~ higiene_vocal  # Para mantener las categorías que no coincidan
  ))

resumen <- data %>% 
  group_by(higiene_vocal) %>% 
  summarise(
    observaciones = n())

# Crear el boxplot con los conteos
ggplot(data = data, aes(x = higiene_vocal, y = VHI, fill = higiene_vocal)) +
  geom_boxplot() +
  labs(title = "Distribución del Score VHI por Rutina de Higiene Vocal",
       x = "Higiene Vocal", y = "Score VHI") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 7.5),
        legend.position = "none") +
  geom_text(data = resumen, aes(x=higiene_vocal, y=Inf, label = paste("n = ", observaciones)),position=position_dodge(0.9) , vjust = 1.5, size = 3)
```

Como podemos observar, sigue sin tener sentido lógico. Aún así, esto puede deberse a un error formulatorio de la pregunta. Habría que aclarar el motivo por el cual un individuo realiza una rutina ya que puede venir motivado por el haber tenido problemas con la voz, en vez de que el motivo principal sea la prevención.
Como solución, podríamos poner una pregunta previa a las que corresponden al VHI que clarificara el motivo de llevar una rutina.


Como se han observado contradicciones lógicas con los resultados del gráfico, buscamos hacer una comparación con otra pregunta para ver si obtenemos mejores resultados. 
Para realizarlo, nos compararemos estas respuestas con la pregunta: "Ha tengut problemes de veu importants i que li han dificultat la feina al llarg del curs 2022-2023?".








**Test de inferencia**

Usaremos el test de chi cuadrado donde nuestra hipótesis nula es "No hay relación entre los cuidados de la voz y la calidad de la misma" y la hipótesis alternativa es "Si hay relación entre los cuidados de la voz y la calidad de la misma".
Realizamos el test
```{r}
# Crear tabla de contingencia
tabla_contingencia <- table(data$higiene_vocal, data$VHI)

# Prueba Chi-cuadrado
chisq_result <- chisq.test(tabla_contingencia)
chisq_result
```
Como nuestro p-valor=0.1177>0.05, aceptamos la hipótesis nula y por tanto, no hay relación entre el cuidado de la voz y la calidad de la misma.

**Cálculo de las OR**

Aunque la prueba chi cuadrado no haya mostrado resultados satisfactorios, intentemos sacar conclusiones mediante las OR. En particular queremos ver si beber mucha agua es un factor protector o un factor de riesgo. Veamos primero la tabla de contingencia:

```{r,echo = FALSE}
data_para_OR = data %>% filter(higiene_vocal %in% c("Mucha agua", "No rutina"))  
tabla = table(data_para_OR$higiene_vocal, data_para_OR$problema_curso22_23) %>%
  as.data.frame.matrix() 

tabla %>%
  gt(rownames_to_stub = TRUE) %>%
  tab_header(
    title = "Tabla de Contingencia: Consumo de Agua y Problemas de Voz",
    subtitle = "Frecuencia de personas que beben agua y tienen problemas de voz"
  )
```
Haciendo los cálculos tenemos que $OR(\text{Tener problemas}|\text{Mucha agua}) = 3.535$, por lo tanto las odds de tener problemas de voz cuando una persona bebe agua son 3.535 veces las odds de tener problemas de voz cuando una persona no sigue rutina. Esto implica que beber agua es un factor de riesgo. La conclusión es bastante desfavorable ya que nos indica que beber mucha agua es problemático para la voz. Aunque tengamos pocos datos, hagamos lo mismo para ver si hacer reposo es un factor de riesgo.


```{r,echo = FALSE}
data_para_OR = data %>% filter(higiene_vocal %in% c("Reposo", "No rutina"))  
tabla = table(data_para_OR$higiene_vocal, data_para_OR$problema_curso22_23) %>%
  as.data.frame.matrix() 

tabla %>%
  gt(rownames_to_stub = TRUE) %>%
  tab_header(
    title = "Tabla de Contingencia: Hacer Reposo y Problemas de Voz",
    subtitle = "Frecuencia de personas que hacen reposo y tienen problemas de voz"
  )
```
En este caso la $OR(\text{Tener problemas}|\text{Reposo})=5.278$, lo que nos vuelve a decir que hacer reposo después de las clases es un factor de riesgo, cosa que también nos parece contradictoria.

**Respuesta a la pregunta 7:**
El resultado del test inferencial, cuadra con el gráfico anterior, ya que este da a entender que el mejor hábito para la voz es no seguir ninguna rutina. Por otra parte, las OR nos dicen que beber mucha agua o hacer reposo son factores de riesgo para la calidad de la voz. 
Aún así, existe la posibilidad de que, debido a la formulación de las preguntas o la ausencia de ellas, no se recopile toda la información de forma adecuada para esclarecer de manera correcta la pregunta, como por ejemplo, la razón por la que se empieza una rutina, como hemos explicado anteriormente.